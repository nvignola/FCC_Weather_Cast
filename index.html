<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <title>FCC Weather Cast</title>
 <script src="https://code.jquery.com/jquery-2.2.0.min.js" type="text/javascript" charset="utf-8"></script>
 <link rel="stylesheet" href="https://cdn.rawgit.com/erikflowers/weather-icons/master/css/weather-icons.min.css" type="text/css" media="all" />
 <style type="text/css" media="all">
    @import url(https://fonts.googleapis.com/css?family=Open+Sans:300,400,600);
    html {
      height: 100%;
    }
    body {
      background: no-repeat center center fixed;
      -webkit-background-size: cover;
      -moz-background-size: cover;
      -o-background-size: cover;
      background-size: cover;
      font-family: 'Open sans', sans-serif;
      font-size: 16px;
      padding: 2em;
    }
    .card {
      -webkit-box-shadow: 0 8px 8px rgba(0, 0, 0, 0.5);
      -moz-box-shadow: 0 8px 8px rgba(0, 0, 0, 0.5);
      box-shadow: 0 8px 8px rgba(0, 0, 0, 0.5);
      box-sizing: border-box;
      border-radius: 3px;
      color: #fff;
      left: 10%;
      padding: 4em;
      position: absolute;
      text-align: center;
      top: 20%;
      width: 300px;
    }
    .card.chill {
      background-color: #5BC0DE;
    }
    .card.ideal {
      background-color: #5CB85C;
    }
    .card.warm {
      background-color: #F0AD4E;
    }
    .card .city {
      margin: 0;
    }
    .card .city,
    .card .temp {
      font-size: 2em;
    }
    .card .weather {
      display: block;
      font-size: 5em;
      margin: 0.5em 0;
    }
    .card .temp {
      font-style: normal;
    }
    .flipswitch {
      left: 50%;
      margin-left: -43px;
      position: absolute;
      width: 86px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    .flipswitch input[type=checkbox] {
      display: none;
    }
    .flipswitch-label {
      display: block;
      overflow: hidden;
      cursor: pointer;
      border: 1px solid #999999;
      border-radius: 50px;
    }
    .flipswitch-inner {
      width: 200%;
      margin-left: -100%;
      -webkit-transition: margin 0.3s ease-in 0s;
      -moz-transition: margin 0.3s ease-in 0s;
      -ms-transition: margin 0.3s ease-in 0s;
      -o-transition: margin 0.3s ease-in 0s;
      transition: margin 0.3s ease-in 0s;
    }
    .flipswitch-inner:before,
    .flipswitch-inner:after {
      float: left;
      width: 50%;
      height: 24px;
      padding: 0;
      line-height: 24px;
      font-size: 18px;
      color: white;
      font-family: Trebuchet, Arial, sans-serif;
      font-weight: bold;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
    }
    .flipswitch-inner:before {
      content: "°C";
      padding-left: 12px;
      background-color: #F0F0F0;
      color: #83BA62;
      text-align: left;
    }
    .flipswitch-inner:after {
      content: "°F";
      padding-right: 12px;
      background-color: #EBEBEB;
      color: #C72031;
      text-align: right;
    }
    .flipswitch-switch {
      width: 31px;
      margin: -3.5px;
      background: #FFFFFF;
      border: 1px solid #999999;
      border-radius: 50px;
      position: absolute;
      top: 0;
      bottom: 0;
      right: 59px;
      -webkit-transition: all 0.3s ease-in 0s;
      -moz-transition: all 0.3s ease-in 0s;
      -ms-transition: all 0.3s ease-in 0s;
      -o-transition: all 0.3s ease-in 0s;
      transition: all 0.3s ease-in 0s;
    }
    .flipswitch-cb:checked + .flipswitch-label .flipswitch-inner {
      margin-left: 0;
    }
    .flipswitch-cb:checked + .flipswitch-label .flipswitch-switch {
      right: 0;
    }

 </style>
</head>
<body>

  <div class="card">
  	<h2 class="city"></h2>
  	<i class="weather wi"></i>
  	<em class="temp">
  		<span class="degree"></span>
  		<span class="metrics"></span>
  	</em>

  	<div class="flipswitch">
      <input type="checkbox" name="flipswitch" class="flipswitch-cb" id="fs" checked>
      <label class="flipswitch-label" for="fs">
          <div class="flipswitch-inner"></div>
          <div class="flipswitch-switch"></div>
      </label>
    </div>
  </div>


<script type="text/javascript" charset="utf-8">
  (function($){

    var App = {
    	"apiKey": {
    		"flickr" : "28602178605addc1a7730e3c90733b22",
    		"openWeather" : "44db6a862fba0b067b1930da0d769e98"
    	},
    	"apiUrl": {
    		"flickr": "https://api.flickr.com/services/rest/?method=flickr.photos.search",
    		"openWeather": "http://api.openweathermap.org/data/2.5/weather?"
    	},
    	"units": "metric",
    	"$container" : $('body'),
    	"$card": $('.card'),
    	"$city": $('.city'),
    	"$weather": $('.weather'),
    	"$temp": $('.temp .degree'),
    	"icons": {
    	  "01d" : "wi-day-sunny",
    	  "01n" : "wi-night-clear",
    	  "02d" : "wi-day-cloudy",
    	  "02n" : "wi-night-alt-cloudy",
    	  "03d" : "wi-cloud",
    	  "03n" : "wi-cloud",
    	  "04d" : "wi-cloudy",
    	  "04n" : "wi-cloudy",
    	  "09d" : "wi-rain",
    	  "09n" : "wi-rain",
    	  "10d" : "wi-day-rain",
    	  "10n" : "wi-night-alt-rain",
    	  "11n" : "wi-day-thunderstorm",
    	  "11d" : "wi-day-thunderstorm",
    	  "13n" : "wi-snow",
    	  "13d" : "wi-snow",
    	  "50d" : "wi-fog",
    	  "50n" : "wi-fog"
    	}
    };

    $.getJSON('http://ipinfo.io', function(data) {
    	var lat = data.loc.split(",")[0],
    			lon = data.loc.split(",")[1];

    	getWeather(lat, lon);

    }, "jsonp");

    function getWeather(lat, lon) {
    	var url = getOpenWeatherApiUrl(lat, lon);

    	$.get(url, function(weather) {
    		var viewObj = {
    			"city" : weather.name,
    			"climateCondition" : weather.weather[0].main,
    			"iconID" : getIconClass(weather.weather[0].icon),
    			"temperature": Number(Math.round(weather.main.temp +'e1')+'e-1'),
    			"temperatureColor" : getTemperatureColor(weather.main.temp)
    		};

    		renderView(viewObj);

    	}, "jsonp");
    }

    function getPhoto(climateCondition, cb) {
    	var url = getFlickrApiUrl(climateCondition);

    	$.get(url, function(photos) {
    		var rand = getRandomArbitrary(0, photos.photos.photo.length),
    		    photoUrl = "https://farm" + photos.photos.photo[rand].farm +
            					".staticflickr.com/" + photos.photos.photo[rand].server + "/" +
            					photos.photos.photo[rand].id + "_" + photos.photos.photo[rand].secret + ".jpg";

    		cb(photoUrl);
    	}, "jsonp");
    }

    function renderView(viewObj) {

    	App.$city.text(viewObj.city);
    	App.$card.addClass(viewObj.temperatureColor);
    	App.$weather.addClass(viewObj.iconID);
    	App.$temp.html(viewObj.temperature);

    	getPhoto(viewObj.climateCondition, function(url){

    		App.$container.css('backgroundImage', "url(" + url + ")");

    	});
    }

    function getTemperatureColor(temp) {
    		var tempColor = "";

    		if(temp <= 12) {
    			tempColor = "chill";
    		} else if (temp <= 25) {
    			tempColor = "ideal";
    		} else {
    			tempColor = "warm";
    		}

    		return tempColor;
    }

    function getOpenWeatherApiUrl(lat, lon) {

    	return App.apiUrl.openWeather +
        		"lat=" + lat +
        		"&lon=" + lon +
        		"&units=" + App.units +
        		"&appid=" + App.apiKey.openWeather;
    }

    function getFlickrApiUrl(climateCondition) {

    	return App.apiUrl.flickr +
        		"&api_key=" + App.apiKey.flickr +
        		"&format=json" +
        		"&content_type=1" +
        		"&accuracy=1" +
        		"&sort=relevance" +
        		"&text=weather " + climateCondition.toLowerCase() +
        		"&jsoncallback=?";
    }

    function getIconClass(iconID) {

      return App.icons[iconID];

    }

    function getRandomArbitrary(min, max) {

      return Math.floor(Math.random() * (max - min) + min);

    }

  })(jQuery);
</script>
</body>
</html>